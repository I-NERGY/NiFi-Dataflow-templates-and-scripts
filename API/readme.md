## API DataFlow
In this example we will cover the API usage in NiFi where we first need to login and get the bearer token which is used afterwards for fetching the actual data.

![image](https://user-images.githubusercontent.com/90190347/189651969-3d166d14-0359-45ad-8ce8-be6089706cf9.png)

## How does it work?

### Logging in and getting the bearer token
Supose we have a remote URL looking like ```https://test.com/login``` where we post login information in this format ```grant_type=password&userName=user&password=password``` that gives us the bearer token in this format ```{"access_token":"TOKEN_HERE"}```. 
We will start with a ```GenerateFlowFile``` processor that has custom text content filled with the login payload.

![image](https://user-images.githubusercontent.com/90190347/189653553-916675fb-d8e0-44d1-9b53-599c4aa5226c.png)

Next we will follow it up with the ```InvokeHTTP``` proccessor which can interact with a configurable HTTP Endpoint. In this case we want to call a ```POST``` request to 
```https://test.com/login``` with a body that was generated by the previous processor. We will need to configure a few properties for this to work, first ```HTTP Method``` to ```POST```, ```Remote URL``` to ```https://test.com/login```, in this case ```Content-Type``` to ```application/json``` and the last and the most important one ```Send Message Body``` to ```true```.

![image](https://user-images.githubusercontent.com/90190347/189655364-9a8f2c80-65be-4176-a266-6719dfb28012.png)

![image](https://user-images.githubusercontent.com/90190347/189655392-9ae87384-6577-409a-a265-aef5621335e6.png)

### Making the bearer token an attribute and calling the API with it
In order to use the API to fetch the data we will need the bearer token that we received in the previous step. To make it an attribute we will use the ```EvaluateJsonPath``` processor to which we will add a new property ```access_token``` with the value of ```$.access_token```.

![image](https://user-images.githubusercontent.com/90190347/189656419-d7738d6e-f7c3-45e6-80c9-e261899e7d7c.png)

Supose we have an URL ```https://test.com/api/current/l1/daily``` that gives us the data that we want, but we need to add ```Authorization``` with our bearer token. We can do that again with the ```InvokeHTTP``` proccessor where we our URL and ```HTTP Method``` to ```GET```. For Authorization we will add a new property called ```Authorization``` with the value of ```Bearer ${access_token}``` where we pass the bearer token that we extracted to an attribute in the previous step.

![image](https://user-images.githubusercontent.com/90190347/189658057-a29a80e7-7f18-40ef-832a-018c4c4456c2.png)

![image](https://user-images.githubusercontent.com/90190347/189658099-821645c2-56e3-46fe-9ffc-4eafc1f99650.png)

All of the other processes are covered in [SQL Comples](https://github.com/I-NERGY/NiFi-Dataflow-templates-and-scripts/tree/developnikola/SQL/SQL_Complex), including posting the data to MongoDB and Kafka.

